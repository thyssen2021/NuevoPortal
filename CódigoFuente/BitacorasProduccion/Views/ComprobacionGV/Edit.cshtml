@model Portal_2_0.Models.GV_solicitud
@using Portal_2_0.Models

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Editar Comprobación de Gastos de Viaje";
    ViewBag.PrimerNivel = "gastos_viaje_comprobacion";
    ViewBag.SegundoNivel = "GV_comprobacion";
    ViewBag.ControllerName = "ComprobacionGV";

    int contador = 0;

    //obtiene los ViewBag para los select
    List<GV_comprobacion_tipo_gastos_viaje> listaCuentas = (List<GV_comprobacion_tipo_gastos_viaje>)ViewBag.ListaCuentas;
    List<GV_comprobacion_tipo_pago> listaTipoPago = (List<GV_comprobacion_tipo_pago>)ViewBag.ListaTipoPago;
    List<GV_centros_costo> listaCentroCosto = (List<GV_centros_costo>)ViewBag.ListaCentroCosto;

}

@section estilos
{
    <!-- Select2 -->
    <link href="@Url.Content("~/Content/vendors/select2/css/select2.css")" rel="stylesheet">
    <link href="@Url.Content("~/Content/vendors/select2-bootstrap4-theme/select2-bootstrap4.min.css")" rel="stylesheet">
    <!-- DataTables -->
    @Styles.Render("~/Content/dataTables_css")
    <!-- iCheck -->
    <link href="@Url.Content("~/Content/vendors/iCheck/skins/square/green.css")" rel="stylesheet">

    <style>

        label {
            text-align: right;
        }

            label::after {
                content: ":";
            }

        nolabel > label::after {
            content: "";
        }

        .fondo_verde {
            background-color: green;
            color: #fffdf0;
            font-weight: bolder;
        }

        .fondo_amarillo {
            background-color: orange;
            color: #221f1f;
            font-weight: bolder;
        }
    </style>
}



<div class="right_col" role="main">
    <div class="">
        <div class="page-title">
            <div class="title_left">
            </div>
        </div>

        <div class="clearfix"></div>

        <div class="row">
            <div class="col-md-12 col-sm-12  ">
                <div class="x_panel">
                    @*<div class="x_title">
                            <h2>@ViewBag.Title</h2>
                            <div class="clearfix"></div>
                        </div>*@
                    <div class="x_content">
                        <br />

                        <div id="accordion">
                            <div class="card">
                                <div class="card-header" id="headingOne">
                                    <h5 class="mb-0">
                                        <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                            <span class="green" style="font-size:large"><i class="fa-solid fa-plane-departure"></i> DETALLES DE SOLICITUD DE GASTOS DE VIAJE (Haga clic para ver los detalles)</span>
                                        </button>
                                    </h5>
                                </div>
                                <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                                    <div class="card-body" style="background-color: #ecf8f8">
                                        <div class="form-group row">
                                            <span style="color:black"><b>DATOS GENERALES (SOLICITUD)</b></span>
                                        </div>
                                        <div class="form-group row">
                                            <!--Folio-->
                                            <div class="col-md-10">
                                            </div>
                                            @Html.LabelFor(model => model.id, new { @class = "control-label col-md-1 float-right" })
                                            <div class="col-md-1">
                                                @Html.EditorFor(model => model.id, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly" } })
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <!--SOLICITANTE-->
                                            @Html.LabelFor(model => model.id_solicitante, new { @class = "control-label col-md-1 float-right" })
                                            <div class="col-md-4">
                                                <input class="form-control" value="@Html.DisplayFor(model => model.empleados5.ConcatNombre)" readonly />
                                            </div>

                                            <!--Estatus-->
                                            @Html.LabelFor(model => model.estatus, new { @class = "control-label col-md-1 float-right" })
                                            <div class="col-md-2">
                                                <input type="text" class="form-control" value="@Bitacoras.Util.GV_solicitud_estatus.DescripcionStatus(Model.estatus)" readonly />
                                            </div>

                                            <!--Fecha-->
                                            @Html.LabelFor(model => model.fecha_solicitud, new { @class = "control-label col-md-2 float-right" })
                                            <div class="col-md-2">
                                                <input type="text" class="form-control" value="@DateTime.Now" readonly />
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <!-- Empleado -->
                                            @Html.LabelFor(model => model.id_empleado, new { @class = "control-label col-md-1" })
                                            <div class="col-md-4">
                                                <input type="text" class="form-control" value="@Html.DisplayFor(model => model.empleados2.ConcatNombre)" readonly />
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <!--Planta-->
                                            @Html.LabelFor(model => model.empleados2.planta_clave, new { @class = "control-label col-md-1 float-right" })
                                            <div class="col-md-3">
                                                <input class="form-control" id="empleado_planta" value="@Html.DisplayFor(model => model.empleados2.plantas.descripcion)" readonly />
                                            </div>
                                            <!--Departamento-->
                                            @Html.LabelFor(model => model.empleados2.id_area, new { @class = "control-label col-md-1 float-right" })
                                            <div class="col-md-3">
                                                <input class="form-control" id="empleado_area" value="@Html.DisplayFor(model => model.empleados2.Area.descripcion)" readonly />
                                            </div>
                                            <!--Puesto-->
                                            @Html.LabelFor(model => model.empleados2.puesto, new { @class = "control-label col-md-1 float-right" })
                                            <div class="col-md-3">
                                                <input class="form-control" id="empleado_puesto" value="@Html.DisplayFor(model => model.empleados2.puesto1.descripcion)" readonly />
                                            </div>

                                        </div>
                                        <div class="form-group row">
                                            <!--Planta-->
                                            @Html.LabelFor(model => model.id_jefe_directo, new { @class = "control-label col-md-1 float-right" })
                                            <div class="col-md-5">
                                                <input class="form-control" id="empleado_jefe" value="@Html.DisplayFor(model => model.empleados2.empleados2.ConcatNombre)" readonly />
                                            </div>

                                        </div>
                                        <div class="ln_solid"></div>

                                        <div class="form-group row">
                                            <span style="color:black"><b>INFORMACI&Oacute;N DEL VIAJE</b></span>
                                        </div>
                                        <!-- Tipo de Viaje -->
                                        <div class="form-group row">
                                            @Html.LabelFor(model => model.tipo_viaje, new { @class = "control-label col-md-1 float-right" })
                                            <div class="col-md-1 col-sm-1 offset-md-1">
                                                <input type="radio" id="nacional" name="tipo_viaje" value="NACIONAL" @(Model.tipo_viaje == Bitacoras.Util.GV_tipo_viaje.NACIONAL || String.IsNullOrEmpty(Model.tipo_viaje) ? "checked" : String.Empty) disabled>
                                                <nolabel>
                                                    <label for="nacional">Nacional</label>
                                                </nolabel>
                                            </div>
                                            <div class="col-md-1 col-sm-1">
                                                <input type="radio" id="extranjero" name="tipo_viaje" value="EXTRANJERO" @(Model.tipo_viaje == Bitacoras.Util.GV_tipo_viaje.EXTRANJERO ? "checked" : String.Empty) disabled>
                                                <nolabel>
                                                    <label for="extranjero">Extranjero</label>
                                                </nolabel>
                                            </div>
                                            @Html.ValidationMessageFor(model => model.tipo_viaje, "", new { @class = "text-danger" })
                                        </div>
                                        <div class="form-group row">
                                            @Html.LabelFor(model => model.origen, new { @class = "control-label col-md-1 float-right" })
                                            <div class="col-md-5">
                                                @Html.EditorFor(model => model.origen, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly" } })
                                            </div>
                                            @Html.LabelFor(model => model.destino, new { @class = "control-label col-md-1 float-right" })
                                            <div class="col-md-5">
                                                @Html.EditorFor(model => model.destino, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly" } })
                                            </div>

                                        </div>
                                        <div class="form-group row">
                                            @Html.LabelFor(model => model.fecha_salida, new { @class = "control-label col-md-1 float-right" })
                                            <div class="col-md-2">
                                                @Html.EditorFor(model => model.fecha_salida, new { htmlAttributes = new { @class = "form-control", @disabled = "disabled" } })
                                            </div>

                                            @Html.LabelFor(model => model.fecha_regreso, new { @class = "control-label col-md-2 float-right" })
                                            <div class="col-md-2">
                                                @Html.EditorFor(model => model.fecha_regreso, new { htmlAttributes = new { @class = "form-control", @disabled = "disabled" } })
                                            </div>
                                            <label class="control-label col-md-1 float-right">Días</label>
                                            <div class="col-md-1">
                                                <input type="text" id="num_dias" name="num_dias" class="form-control" readonly>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <span style="color:black"><b>MOTIVO DE VIAJE</b></span>
                                        </div>
                                        <div class="item form-group">
                                            <div class="col-md-12">
                                                @Html.TextAreaFor(model => model.motivo_viaje, new { @class = "form-control", @rows = "4", @readonly = "readonly" })
                                            </div>
                                        </div>
                                        <div class="ln_solid"></div>

                                        @if (Model.moneda_extranjera)
                                        {
                                            <!-- Solo aplica con moneda extranjera -->
                                            <div id="div_moneda_extranjera">
                                                <div class="form-group row">
                                                    <span style="color:black"><b>ESTIMACI&Oacute;N DE GASTOS A REALIZAR (MONEDA EXTRANJERA)</b></span>

                                                </div>
                                                <div class="form-group row">

                                                </div>
                                                <div class="form-group row">
                                                    @Html.LabelFor(model => model.moneda_extranjera, new { @class = "control-label col-md-1 text_derecha" })
                                                    <div class="col-md-1">
                                                        @Html.EditorFor(m => m.moneda_extranjera, new { htmlAttributes = new { disabled = "disabled" } })
                                                    </div>
                                                    <!-- Moneda -->
                                                    @Html.LabelFor(model => model.iso_moneda_extranjera, new { @class = "control-label col-md-1" })
                                                    <div class="col-md-3">
                                                        <input type="text" class="form-control" value="@Model.iso_moneda_extranjera" readonly />
                                                    </div>
                                                    @Html.LabelFor(model => model.moneda_extranjera_monto, new { @class = "control-label col-md-1 text_derecha" })
                                                    <div class="col-md-2">
                                                        @Html.EditorFor(m => m.moneda_extranjera_monto, new { htmlAttributes = new { @class = "precio form-control", @readonly = "readonly" } })
                                                    </div>
                                                </div>

                                                <div class="item form-group">
                                                    @Html.LabelFor(model => model.moneda_extranjera_comentarios, new { @class = "control-label col-md-12 col-sm-12", @style = "text-align:left" })

                                                </div>
                                                <div class="item form-group">
                                                    <div class="col-md-12">
                                                        @Html.TextAreaFor(model => model.moneda_extranjera_comentarios, new { @class = "form-control", @rows = "4", @readonly = "readonly" })
                                                    </div>
                                                </div>

                                                <div class="ln_solid"></div>
                                            </div>

                                        }

                                        <div class="table-responsive">
                                            <table id="datatable_1" class="table table-striped table-bordered" cellspacing="0" width="100%">
                                                <thead>
                                                    <tr style=" background-color: #0094ff; color: azure;">
                                                        <th width="20%">
                                                            Concepto
                                                        </th>
                                                        <th width="12%">
                                                            Importe
                                                        </th>
                                                        <th width="12%">
                                                            Cantidad o días
                                                        </th>
                                                        <th width="12%">
                                                            Total
                                                        </th>
                                                        <th width="40%">
                                                            Comentarios
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (var item in Model.GV_rel_gastos_solicitud)
                                                    {
                                                        <tr>
                                                            <td style="font-weight:bold">@item.GV_tipo_gastos_viaje.descripcion</td>
                                                            <td style="text-align:right">
                                                                $ @string.Format(System.Globalization.CultureInfo.GetCultureInfo("es-US"), "{0:N2}", item.importe)
                                                            </td>
                                                            <td style="text-align:right">
                                                                @string.Format(System.Globalization.CultureInfo.GetCultureInfo("es-US"), "{0:N2}", item.cantidad)
                                                            </td>
                                                            <td id="total_fila_@contador" style="text-align:right" nowrap>
                                                                $ @string.Format(System.Globalization.CultureInfo.GetCultureInfo("es-US"), "{0:N2}", item.total)
                                                            </td>
                                                            <td>
                                                                @item.comentarios
                                                            </td>
                                                        </tr>
                                                        contador++;
                                                    }
                                                </tbody>

                                                <tfoot>
                                                    <tr>
                                                        <th colspan="3" style="text-align:right">Total</th>
                                                        <th id="total_gastos" style="text-align:right" nowrap>$ @string.Format(System.Globalization.CultureInfo.GetCultureInfo("es-US"), "{0:N2}", Model.sumaGastosNacional) MXN</th>
                                                        <th></th>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>

                                        <div class="form-group row">
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                        @using (Html.BeginForm(null, null, FormMethod.Post, new { enctype = "multipart/form-data", @class = "form-horizontal form-label-left", @id = "formulario" }))
                        {
                            @Html.AntiForgeryToken()


                            @* Agrega campos ocultos para evitar que falle la validación del modelo de solicitud *@
                            @Html.HiddenFor(model => model.id)
                            @Html.HiddenFor(model => model.origen)
                            @Html.HiddenFor(model => model.destino)
                            @Html.HiddenFor(model => model.id_medio_transporte)
                            @Html.HiddenFor(model => model.motivo_viaje)
                            @Html.HiddenFor(model => model.tipo_viaje)
                            @Html.HiddenFor(model => model.GV_comprobacion.id_gv_solicitud)
                            @Html.HiddenFor(model => model.GV_comprobacion.estatus)
                            @Html.HiddenFor(model => model.GV_comprobacion.fecha_comprobacion)
                            @Html.HiddenFor(model => model.GV_comprobacion.comentario_rechazo)
                            @Html.HiddenFor(model => model.GV_comprobacion.id_jefe_directo)
                            <input type="hidden" name="cambio_documento_formulario" id="cambio_documento_formulario" value="0" />
                      
                            <div class="ln_solid"></div>
                            <div class="form-group row">
                                <div class="col-md-12" style="text-align:center">
                                    <span class="green" style="font-size:x-large"><i class="fa-solid fa-check-to-slot"></i> COMPROBACI&Oacute;N DE GASTOS DE VIAJE</span>
                                </div>
                            </div>
                            <div class="ln_solid"></div>

                            <div class="form-group row">
                                @if ((Model.GV_comprobacion.estatus == Bitacoras.Util.GV_comprobacion_estatus.RECHAZADO_CONTABILIDAD || Model.GV_comprobacion.estatus == Bitacoras.Util.GV_comprobacion_estatus.RECHAZADO_CONTROLLING
                                    || Model.GV_comprobacion.estatus == Bitacoras.Util.GV_comprobacion_estatus.RECHAZADO_JEFE || Model.GV_comprobacion.estatus == Bitacoras.Util.GV_comprobacion_estatus.RECHAZADO_NOMINA)
                                    && !String.IsNullOrEmpty(Model.GV_comprobacion.comentario_rechazo))
                                {
                                    <div class="alert alert-danger col-md-12" role="alert">
                                        <i class="fa fa-exclamation-triangle" style="color:yellow"></i> <b>Raz&oacute;n de Rechazo: </b> @Model.GV_comprobacion.comentario_rechazo
                                    </div>
                                }
                            </div>

                            if (!Html.ViewData.ModelState.IsValid)
                            {
                                <div class="alert alert-danger" role="alert">
                                    @Html.ValidationSummary("", new { @class = "text-white" })
                                </div>
                            }
                            <div class="form-group row">
                                <span style="color:black"><b>CENTRO DE COSTO</b></span>
                            </div>
                            <div class="form-group row">
                                <!--Empleado-->
                                @Html.LabelFor(model => model.id_empleado, new { @class = "control-label col-md-1 float-right" })
                                <div class="col-md-4">
                                    <input class="form-control" value="@Html.DisplayFor(model => model.empleados2.ConcatNombre)" readonly />
                                </div>

                                <!--Empleado-->
                                @Html.LabelFor(model => model.empleados2.numeroEmpleado, new { @class = "control-label col-md-1 float-right" })
                                <div class="col-md-1">
                                    <input class="form-control" value="@Html.DisplayFor(model => model.empleados2.numeroEmpleado)" readonly />
                                </div>

                                <!--tarjeta Business card-->
                                @Html.LabelFor(model => model.GV_comprobacion.business_card, new { @class = "control-label col-md-1 float-right" })
                                <div class="col-md-3">
                                    @Html.EditorFor(model => model.GV_comprobacion.business_card, new { htmlAttributes = new { @class = "form-control col-md-12", @autocomplete = "off" } })
                                    @Html.ValidationMessageFor(model => model.GV_comprobacion.business_card, "", new { @class = "text-danger" })
                                </div>

                            </div>

                            <br />
                            <div class="table-responsive">
                                <table id="datatable_2" class="table table-striped table-bordered" cellspacing="0" width="100%">
                                    <thead>
                                        <tr style=" background-color: #0094ff; color: azure;">
                                            <th width="1%">
                                                #
                                            </th>
                                            <th>Origen</th>
                                            <th nowrap>
                                                Cuenta @for (int i = 0; i < 15; i++)
                                                {
                                                    <span>&ensp;</span>
                                                }
                                            </th>
                                            <th nowrap>
                                                Centro de Costo @for (int i = 0; i < 16; i++)
                                                {
                                                    <span>&ensp;</span>
                                                }
                                            </th>
                                            <th nowrap>
                                                Descripci&oacute;n @for (int i = 0; i < 20; i++)
                                                {
                                                    <span>&ensp;</span>
                                                }
                                            </th>
                                            <th nowrap>
                                                Tipo de Pago @for (int i = 0; i < 10; i++)
                                                {
                                                    <span>&ensp;</span>
                                                }
                                            </th>
                                            <th>
                                                Cantidad
                                            </th>
                                            <th>
                                                Precio Unitario
                                            </th>
                                            <th>
                                                Importe
                                            </th>
                                            @*<th>
                                Descuento
                            </th>*@
                                            <th>
                                                % IVA
                                            </th>
                                            <th>
                                                Total IVA
                                            </th>
                                            <th>
                                                % ISR
                                            </th>
                                            <th>
                                                Total ISR
                                            </th>
                                            <th>
                                                % IEPS
                                            </th>
                                            <th>
                                                Total IEPS
                                            </th>
                                            @*<th>
                                Total Translados
                            </th>*@
                                            <th>
                                                Total Retenciones
                                            </th>
                                            <th>
                                                Imp. Locales
                                            </th>
                                            <th>
                                                Total
                                            </th>
                                            <th>Total MXN</th>
                                            <th nowrap>
                                                Comentario @for (int i = 0; i < 20; i++)
                                                {
                                                    <span>&ensp;</span>
                                                }
                                            </th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="body_conceptos">
                                        @foreach (var concepto in Model.GV_comprobacion_rel_gastos)
                                        {
                                            switch (concepto.concepto_tipo)
                                            {
                                                case Bitacoras.Util.GV_comprobacion_origen.COFIDI_RESUMEN:
                                                case Bitacoras.Util.GV_comprobacion_origen.XML_RESUMEN:
                                                    <tr style="background-color:#FFEB9C" class="div_@concepto.uuid">
                                                        <input type="hidden" name="GV_comprobacion_rel_gastos.Index" id="GV_comprobacion_rel_gastos.Index" value=@contador />
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].id" name=" GV_comprobacion_rel_gastos[@contador].id" value="@concepto.id">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].concepto_tipo" name=" GV_comprobacion_rel_gastos[@contador].concepto_tipo" value="@concepto.concepto_tipo">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].factura" name=" GV_comprobacion_rel_gastos[@contador].factura" value="@concepto.factura">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].fecha_factura" name=" GV_comprobacion_rel_gastos[@contador].fecha_factura" value="@concepto.fecha_factura">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].importe" name=" GV_comprobacion_rel_gastos[@contador].importe" value="@concepto.importe">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].iva_total" name=" GV_comprobacion_rel_gastos[@contador].iva_total" value="@concepto.iva_total">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].isr_total" name=" GV_comprobacion_rel_gastos[@contador].isr_total" value="@concepto.isr_total">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].ieps_total" name=" GV_comprobacion_rel_gastos[@contador].ieps_total" value="@concepto.ieps_total">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].total_retenciones" name=" GV_comprobacion_rel_gastos[@contador].total_retenciones" value="@concepto.total_retenciones">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].impuestos_locales" name=" GV_comprobacion_rel_gastos[@contador].impuestos_locales" value="@concepto.impuestos_locales">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].total_mxn" name=" GV_comprobacion_rel_gastos[@contador].total_mxn" value="@concepto.total_mxn">
                                                        <td class=" input-contador-conceptos"></td>
                                                        <td>@Bitacoras.Util.GV_comprobacion_origen.DescripcionOrigen(concepto.concepto_tipo)</td>
                                                        <td><b>Fecha:</b> @concepto.fecha_factura.Value.ToShortDateString()</td>
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].fecha_factura" name="GV_comprobacion_rel_gastos[@contador].fecha_factura" value="@concepto.fecha_factura">
                                                        <td colspan="2" nowrap>
                                                            <b>UUID:</b> <custom-div class=" class-uuid">@concepto.uuid</custom-div>
                                                            <br /><b>Factura: </b>@concepto.factura
                                                        </td>
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].uuid" name="GV_comprobacion_rel_gastos[@contador].uuid" value="@concepto.uuid">
                                                        <td colspan="1"> <b>Tipo de Cambio:</b> @concepto.tipo_cambio</td>
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].tipo_cambio" name="GV_comprobacion_rel_gastos[@contador].tipo_cambio" value="@concepto.tipo_cambio">
                                                        <td colspan="2"> <b>Moneda:</b> @concepto.currency_iso</td>
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].currency_iso" name="GV_comprobacion_rel_gastos[@contador].currency_iso" value="@concepto.currency_iso">
                                                        <td colspan="8">
                                                            @if (concepto.id > 0 && concepto.concepto_tipo == Bitacoras.Util.GV_comprobacion_origen.XML_RESUMEN)
                                                            {
                                                                <a href="/Combos/DownloadFile/?idDocumento=@concepto.id_archivo_pdf&inline=true" class="btn btn-info" title="Ver PDF" target="_blank"><i class="fa-solid fa-file-pdf"></i></a>
                                                                <a href="/Combos/DownloadFile/?idDocumento=@concepto.id_archivo_xml&inline=true" class="btn btn-info" title="Ver XML" target="_blank"><i class="fa-solid fa-code"></i></a>
                                                            }
                                                            else if ((concepto.ExisteEnCOFIDI.HasValue && concepto.ExisteEnCOFIDI.Value) || (concepto.id > 0 && concepto.concepto_tipo == Bitacoras.Util.GV_comprobacion_origen.COFIDI_RESUMEN))
                                                            {
                                                                <a href="/Combos/MuestraArchivo/?uuid=@concepto.uuid" class="btn btn-info" title="Ver PDF" target="_blank"><i class="fa-solid fa-file-pdf"></i></a>
                                                                <a href="/Combos/MuestraArchivoXML/?uuid=@concepto.uuid" class="btn btn-info" title="Ver XML" target="_blank"><i class="fa-solid fa-code"></i></a>
                                                            }
                                                            else
                                                            {
                                                                <label for="GV_comprobacion_rel_gastos[@contador].PostedFileXML" class="control-label col-md-1">XML</label>
                                                                <div class="col-md-11">
                                                                    <div class="input-group">
                                                                        <div class="custom-file">
                                                                            <input type="file" id="GV_comprobacion_rel_gastos[@contador].PostedFileXML" name="GV_comprobacion_rel_gastos[@contador].PostedFileXML" class="custom-file-input" accept=".xml,.XML" required />
                                                                            <label class="custom-file-label" for="GV_comprobacion_rel_gastos[@contador].PostedFileXML" style="text-align:left">Seleccione un archivo...</label>
                                                                        </div>
                                                                    </div>
                                                                    <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[@contador].PostedFileXML data-valmsg-replace=" true"></span>
                                                                </div>
                                                                <label for="GV_comprobacion_rel_gastos[@contador].PostedFilePDF" class="control-label col-md-1">PDF</label>
                                                                <div class="col-md-11">
                                                                    <div class="input-group">
                                                                        <div class="custom-file">
                                                                            <input type="file" id="GV_comprobacion_rel_gastos[@contador].PostedFilePDF" name="GV_comprobacion_rel_gastos[@contador].PostedFilePDF" class="custom-file-input" accept=".pdf,.PDF" required />
                                                                            <label class="custom-file-label" for="GV_comprobacion_rel_gastos[@contador].PostedFilePDF" style="text-align:left">Seleccione un archivo...</label>
                                                                        </div>
                                                                    </div>
                                                                    <span class="field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[@contador].PostedFilePDF data-valmsg-replace="true"></span>
                                                                </div>
                                                            }
                                                        </td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td>
                                                            <textarea style="font-size:12px;" type="text" name="GV_comprobacion_rel_gastos[@contador].comentario" id="GV_comprobacion_rel_gastos[@contador].comentario" class="form-control col-md-12" autocomplete="off" maxlength="150" rows="5">@concepto.comentario</textarea>
                                                            <span class="field-validation-valid text-danger" data-valmsg-for="GV_comprobacion_rel_gastos[@contador].comentario" data-valmsg-replace="true"></span>
                                                        </td>
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].ExisteEnCOFIDI" name="GV_comprobacion_rel_gastos[@contador].ExisteEnCOFIDI" value="@(concepto.ExisteEnCOFIDI.HasValue && !concepto.ExisteEnCOFIDI.Value ? " false" : "true" )">
                                                        <td><input type="button" value="Borrar" class="btn btn-danger" onclick="borrarConcepto('@concepto.uuid'); return false;"></td>

                                                    </tr>
                                                    break;
                                                case Bitacoras.Util.GV_comprobacion_origen.COFIDI_CONCEPTO:
                                                case Bitacoras.Util.GV_comprobacion_origen.XML_CONCEPTO:
                                                    <tr style="background-color:#C9DCC1" class="div_@concepto.uuid">
                                                        <input type="hidden" name="GV_comprobacion_rel_gastos.Index" id="GV_comprobacion_rel_gastos.Index" value="@contador" />
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].id" name=" GV_comprobacion_rel_gastos[@contador].id" value="@concepto.id">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].concepto_tipo" name="GV_comprobacion_rel_gastos[@contador].concepto_tipo" value="@concepto.concepto_tipo">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].uuid" name="GV_comprobacion_rel_gastos[@contador].uuid" value="@concepto.uuid">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].descripcion" name="GV_comprobacion_rel_gastos[@contador].descripcion" value="@concepto.descripcion">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].cantidad" name="GV_comprobacion_rel_gastos[@contador].cantidad" value="@concepto.cantidad">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].precio_unitario" name="GV_comprobacion_rel_gastos[@contador].precio_unitario" value="@concepto.precio_unitario">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].importe" name="GV_comprobacion_rel_gastos[@contador].importe" value="@concepto.importe">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].iva_porcentaje" name="GV_comprobacion_rel_gastos[@contador].iva_porcentaje" value="@concepto.iva_porcentaje">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].iva_total" name="GV_comprobacion_rel_gastos[@contador].iva_total" value="@concepto.iva_total">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].isr_porcentaje" name="GV_comprobacion_rel_gastos[@contador].isr_porcentaje" value="@concepto.isr_porcentaje">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].isr_total" name="GV_comprobacion_rel_gastos[@contador].isr_total" value="@concepto.isr_total">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].ieps_porcentaje" name="GV_comprobacion_rel_gastos[@contador].ieps_porcentaje" value="@concepto.ieps_porcentaje">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].ieps_total" name="GV_comprobacion_rel_gastos[@contador].ieps_total" value="@concepto.ieps_total">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].total_retenciones" name="GV_comprobacion_rel_gastos[@contador].total_retenciones" value="@concepto.total_retenciones">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].total_mxn" name="GV_comprobacion_rel_gastos[@contador].total_mxn" value="@concepto.total_mxn">
                                                        <td colspan="1"></td>
                                                        <td colspan="1"></td>
                                                        <td nowrap>
                                                            <select name="GV_comprobacion_rel_gastos[@contador].id_comprobacion_tipo_gastos_viaje" id="GV_comprobacion_rel_gastos[@contador].id_comprobacion_tipo_gastos_viaje" class="form-control select2bs4 cuenta" data-uuid="@concepto.uuid" style="width:100%" required>
                                                                <option value=''>-- Seleccione un valor --</option>
                                                                @foreach (var item in listaCuentas)
                                                                {
                                                                    <option value="@item.id" @(concepto.id_comprobacion_tipo_gastos_viaje==item.id ? "selected" : null )>@item.ConcatCuenta</option>
                                                                }
                                                            </select>
                                                            <span class="field-validation-valid text-danger" data-valmsg-for="GV_comprobacion_rel_gastos[@contador].id_comprobacion_tipo_gastos_viaje" data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td nowrap>
                                                            <select name="GV_comprobacion_rel_gastos[@contador].id_centro_costo" id="GV_comprobacion_rel_gastos[@contador].id_centro_costo" class="form-control select2bs4 centro-costo" data-uuid="@concepto.uuid" style="width:100%" required>
                                                                <option value=''>-- Seleccione un valor --</option>
                                                                @foreach (var planta in listaCentroCosto.Select(x => x.plantas).Distinct())
                                                                {

                                                                    <optgroup label="@planta.descripcion">
                                                                        @foreach (var cc in listaCentroCosto.Where(x => x.clave_planta == planta.clave))
                                                                        {
                                                                            <option value="@cc.id" @(concepto.id_centro_costo==cc.id ? "selected" : null )>@cc.ConcatCentroDeptoPlanta</option>
                                                                        }
                                                                    </optgroup>
                                                                }
                                                            </select>
                                                            <span class="field-validation-valid text-danger" data-valmsg-for="GV_comprobacion_rel_gastos[@contador].id_centro_costo" data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td>@concepto.descripcion</td>
                                                        <td>
                                                            <select name="GV_comprobacion_rel_gastos[@contador].id_comprobacion_tipo_pago" id="GV_comprobacion_rel_gastos[@contador].id_comprobacion_tipo_pago" class="form-control select2bs4 tipo-pago" data-uuid="@concepto.uuid" style="width:100%" required>
                                                                <option value=''>-- Seleccione un valor --</option>
                                                                @foreach (var item in listaTipoPago)
                                                                {
                                                                    <option value="@item.id" @(concepto.id_comprobacion_tipo_pago==item.id ? "selected" : null )>@item.descripcion</option>
                                                                }
                                                            </select>
                                                            <span class="field-validation-valid text-danger" data-valmsg-for="GV_comprobacion_rel_gastos[@contador].id_comprobacion_tipo_pago" data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td> @(concepto.cantidad.HasValue ? concepto.cantidad.Value.ToString("0.00") : "--")</td>
                                                        <td nowrap style="text-align:right">@(concepto.precio_unitario.HasValue ? concepto.precio_unitario.Value.ToString("$ #,##0.00") : "--")</td>
                                                        <td nowrap style="text-align:right">@(concepto.importe.HasValue ? concepto.importe.Value.ToString("$ #,##0.00") : "--")</td>
                                                        <td nowrap style="text-align:right">@(concepto.iva_porcentaje.HasValue ? concepto.iva_porcentaje.Value.ToString("0.00 %") : "--")</td>
                                                        <td nowrap style="text-align:right">@(concepto.iva_total.HasValue ? concepto.iva_total.Value.ToString("$ #,##0.00") : "--")</td>
                                                        <td nowrap style="text-align:right">@(concepto.isr_porcentaje.HasValue ? concepto.isr_porcentaje.Value.ToString("0.00 %") : "--")</td>
                                                        <td nowrap style="text-align:right">@(concepto.isr_total.HasValue ? concepto.isr_total.Value.ToString("$ #,##0.00") : "--")</td>
                                                        <td nowrap style="text-align:right">@(concepto.ieps_porcentaje.HasValue ? concepto.ieps_porcentaje.Value.ToString("0.00 %") : "--")</td>
                                                        <td nowrap style="text-align:right">@(concepto.ieps_total.HasValue ? concepto.ieps_total.Value.ToString("$ #,##0.00") : "--")</td>
                                                        <td nowrap style="color:#C10000; text-align:right">@(concepto.total_retenciones.HasValue ? concepto.total_retenciones.Value.ToString("$ #,##0.00") : "--")</td>
                                                        <td></td>
                                                        <td nowrap style="text-align:right">@(concepto.total_mxn.HasValue ? concepto.total_mxn.Value.ToString("$ #,##0.00") : "--")</td>
                                                        <td colspan="3"></td>
                                                    </tr>
                                                    break;
                                                case Bitacoras.Util.GV_comprobacion_origen.COFIDI_TOTALES:
                                                case Bitacoras.Util.GV_comprobacion_origen.XML_TOTALES:
                                                    <tr style="background-color:#AAE0FF" class="div_@concepto.uuid">
                                                        <input type="hidden" name="GV_comprobacion_rel_gastos.Index" id="GV_comprobacion_rel_gastos.Index" value="@contador" />
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].id" name=" GV_comprobacion_rel_gastos[@contador].id" value="@concepto.id">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].concepto_tipo" name="GV_comprobacion_rel_gastos[@contador].concepto_tipo" value="@concepto.concepto_tipo">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].importe" name="GV_comprobacion_rel_gastos[@contador].importe" value="@concepto.importe">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].iva_total" name="GV_comprobacion_rel_gastos[@contador].iva_total" value="@concepto.iva_total">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].isr_total" name="GV_comprobacion_rel_gastos[@contador].isr_total" value="@concepto.isr_total">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].ieps_total" name="GV_comprobacion_rel_gastos[@contador].ieps_total" value="@concepto.ieps_total">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].total_retenciones" name="GV_comprobacion_rel_gastos[@contador].total_retenciones" value="@concepto.total_retenciones">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].impuestos_locales" name="GV_comprobacion_rel_gastos[@contador].impuestos_locales" value="@concepto.impuestos_locales">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].total_mxn" name="GV_comprobacion_rel_gastos[@contador].total_mxn" value="@concepto.total_mxn">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].fecha_factura" name="GV_comprobacion_rel_gastos[@contador].fecha_factura" value="@concepto.fecha_factura">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].uuid" name="GV_comprobacion_rel_gastos[@contador].uuid" value="@concepto.uuid">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].currency_iso" name="GV_comprobacion_rel_gastos[@contador].currency_iso" value="@concepto.currency_iso">
                                                        <td></td>
                                                        <td colspan="7" style="text-align:right"><b>Totales Factura:</b></td>
                                                        <td nowrap style="text-align:right">@(concepto.importe.HasValue ? concepto.importe.Value.ToString("$ #,##0.00") : "--")</td>
                                                        <td></td>
                                                        <td nowrap style="text-align:right">@(concepto.iva_total.HasValue ? concepto.iva_total.Value.ToString("$ #,##0.00") : "--")</td>
                                                        <td></td>
                                                        <td nowrap style="text-align:right">@(concepto.isr_total.HasValue ? concepto.isr_total.Value.ToString("$ #,##0.00") : "--")</td>
                                                        <td></td>
                                                        <td nowrap style="text-align:right">@(concepto.ieps_total.HasValue ? concepto.ieps_total.Value.ToString("$ #,##0.00") : "--")</td>
                                                        <td nowrap style="color:#C10000; text-align:right">@(concepto.total_retenciones.HasValue ? concepto.total_retenciones.Value.ToString("$ #,##0.00") : "--")</td>
                                                        <td nowrap style="text-align:right">@(concepto.impuestos_locales.HasValue ? concepto.impuestos_locales.Value.ToString("$ #,##0.00") : "--")</td>
                                                        <td nowrap style="text-align:right">@(concepto.total_mxn.HasValue ? concepto.total_mxn.Value.ToString("$ #,##0.00") : "--")</td>
                                                        <td nowrap class="item-total-mxn" style="text-align:right; font-weight:bold">@(concepto.total_mxn.HasValue ? concepto.total_mxn.Value.ToString("$ #,##0.00") : "--")</td>
                                                        <td colspan="2"></td>
                                                    </tr>
                                                    break;
                                                case Bitacoras.Util.GV_comprobacion_origen.GASTO_EXTRANJERO:
                                                    <tr style="background-color:#FFEB9C" class="div_@contador">
                                                        <input type="hidden" name="GV_comprobacion_rel_gastos.Index" id="GV_comprobacion_rel_gastos.Index" value="@contador" />
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].id" name="GV_comprobacion_rel_gastos[@contador].id" value="@concepto.id">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].concepto_tipo" name="GV_comprobacion_rel_gastos[@contador].concepto_tipo" value="@Bitacoras.Util.GV_comprobacion_origen.GASTO_EXTRANJERO">
                                                        <td class="input-contador-conceptos"></td>
                                                        <td>@Bitacoras.Util.GV_comprobacion_origen.DescripcionOrigen(concepto.concepto_tipo)</td>
                                                        <td>
                                                            <b>Fecha:</b> <input type="date" class="form-control" name="GV_comprobacion_rel_gastos[@contador].fecha_factura" id="GV_comprobacion_rel_gastos[@contador].fecha_factura" value="@concepto.fecha_factura.Value.ToString("yyyy-MM-dd")" required>
                                                            <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[@contador].fecha_factura data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td nowrap>
                                                            <b>Cuenta:</b>
                                                            <select name="GV_comprobacion_rel_gastos[@contador].id_comprobacion_tipo_gastos_viaje" id="GV_comprobacion_rel_gastos[@contador].id_comprobacion_tipo_gastos_viaje" class="form-control select2bs4" style="width:100%" required>
                                                                <option value=''>-- Seleccione un valor --</option>
                                                                @foreach (var item in listaCuentas)
                                                                {
                                                                    <option value="@item.id" @(concepto.id_comprobacion_tipo_gastos_viaje==item.id ? "selected" : null )>@item.ConcatCuenta</option>
                                                                }
                                                            </select>
                                                            <span class="field-validation-valid text-danger" data-valmsg-for="GV_comprobacion_rel_gastos[@contador].id_comprobacion_tipo_gastos_viaje" data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td nowrap>
                                                            <b>Centro de Costo:</b>
                                                            <select name="GV_comprobacion_rel_gastos[@contador].id_centro_costo" id="GV_comprobacion_rel_gastos[@contador].id_centro_costo" class="form-control select2bs4" style="width:100%" required>
                                                                <option value=''>-- Seleccione un valor --</option>
                                                                @foreach (var planta in listaCentroCosto.Select(x => x.plantas).Distinct())
                                                                {
                                                                    <optgroup label="@planta.descripcion">
                                                                        @foreach (var cc in listaCentroCosto.Where(x => x.clave_planta == planta.clave))
                                                                        {
                                                                            <option value="@cc.id" @(concepto.id_centro_costo==cc.id ? "selected" : null )>@cc.ConcatCentroDeptoPlanta</option>
                                                                        }
                                                                    </optgroup>
                                                                }
                                                            </select>
                                                            <span class="field-validation-valid text-danger" data-valmsg-for="GV_comprobacion_rel_gastos[@contador].id_centro_costo" data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td colspan="1">
                                                            <b>Tipo de Cambio:</b> <input type="text" class="numero-decimal form-control concepto-extranjero" name="GV_comprobacion_rel_gastos[@contador].tipo_cambio" id="GV_comprobacion_rel_gastos[@contador].tipo_cambio" data-row="@contador" value="@concepto.tipo_cambio" required>
                                                            <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[@contador].tipo_cambio data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td colspan="2">
                                                            <b>Moneda:</b>
                                                            <select name="GV_comprobacion_rel_gastos[@contador].currency_iso" id="GV_comprobacion_rel_gastos[@contador].currency_iso" class="form-control select2bs4" style="width:100%" required>
                                                                <option value=''>-- Seleccione un valor --</option>
                                                                <option value="USD" @(concepto.currency_iso=="USD" ? "selected" : null )>USD</option>
                                                                <option value="EUR" @(concepto.currency_iso=="EUR" ? "selected" : null )>EUR</option>
                                                            </select>
                                                            <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[@contador].currency_iso data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td colspan="8">
                                                            @if (concepto.id > 0)
                                                            {
                                                                <a href="/Combos/DownloadFile/?idDocumento=@concepto.id_archivo_comprobante_extranjero&inline=true" class="btn btn-info" title="Ver PDF" target="_blank"><i class="fa-solid fa-file-pdf"></i></a>
                                                            }
                                                            else
                                                            {
                                                                <b>Comprobante:</b>
                                                                <div class="col-md-11">
                                                                    <div class="input-group">
                                                                        <div class="custom-file">
                                                                            <input type="file" id="GV_comprobacion_rel_gastos[@contador].PostedFileExtranjero" name="GV_comprobacion_rel_gastos[@contador].PostedFileExtranjero" class="custom-file-input" accept=".png,.PNG, .jpeg, .JPEG, .png, .PNG, .rar, .RAR, .ZIP, .zip, .pdf, .PDF, .xml, .XML" required />
                                                                            <label class="custom-file-label" for="GV_comprobacion_rel_gastos[@contador].PostedFileExtranjero" style="text-align:left">Seleccione un archivo...</label>
                                                                        </div>
                                                                    </div>
                                                                    <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[@contador].PostedFileExtranjero data-valmsg-replace=" true"></span>
                                                                </div>
                                                            }
                                                        </td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td>
                                                            <textarea style="font-size:12px;" type="text" name="GV_comprobacion_rel_gastos[@contador].comentario" id="GV_comprobacion_rel_gastos[@contador].comentario" class="form-control col-md-12" autocomplete="off" maxlength="150" rows="4">@concepto.comentario</textarea>
                                                            <span class="field-validation-valid text-danger" data-valmsg-for="GV_comprobacion_rel_gastos[@contador].comentario" data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td><input type="button" value="Borrar" class="btn btn-danger" onclick="borrarConcepto(@contador); return false;"></td>
                                                    </tr>
                                                    <!-- Segunda linea-->
                                                    <tr style="background-color: #C9DCC1" class="div_@contador">
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td colspan="2">
                                                            <b>Descripción:</b> <input type="text" class="form-control" name="GV_comprobacion_rel_gastos[@contador].descripcion" id="GV_comprobacion_rel_gastos[@contador].descripcion" maxlength="350" autocomplete="off" value="@concepto.descripcion" required>
                                                            <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[@contador].descripcion data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td nowrap>
                                                            <b>Tipo Pago:</b>
                                                            <select name="GV_comprobacion_rel_gastos[@contador].id_comprobacion_tipo_pago" id="GV_comprobacion_rel_gastos[@contador].id_comprobacion_tipo_pago" class="form-control select2bs4" style="width:100%" required>
                                                                <option value=''>-- Seleccione un valor --</option>
                                                                @foreach (var item in listaTipoPago)
                                                                {
                                                                    <option value="@item.id" @(concepto.id_comprobacion_tipo_pago==item.id ? "selected" : null )>@item.descripcion</option>
                                                                }
                                                            </select>
                                                        </td>
                                                        <td colspan="2"></td>
                                                        <td colspan="3">
                                                            <b>Importe:</b> <input type="text" class="importe form-control concepto-extranjero" name="GV_comprobacion_rel_gastos[@contador].importe" id="GV_comprobacion_rel_gastos[@contador].importe" data-row="@contador" value="@concepto.importe" required>
                                                            <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[@contador].importe data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td colspan="6"></td>
                                                        <td colspan="1"></td>
                                                        <td colspan="1" class="item-total-mxn" id="total-mxn_@contador" style="font-weight: bold; text-align: right;"></td>
                                                        <td colspan="2"></td>
                                                    </tr>
                                                    break;
                                                case Bitacoras.Util.GV_comprobacion_origen.GASTO_SIN_COMPROBANTE:
                                                    <tr style="background-color:#FFEB9C" class="div_@contador">
                                                        <input type="hidden" name="GV_comprobacion_rel_gastos.Index" id="GV_comprobacion_rel_gastos.Index" value="@contador" />
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].id" name="GV_comprobacion_rel_gastos[@contador].id" value="@concepto.id">
                                                        <input type="hidden" id="GV_comprobacion_rel_gastos[@contador].concepto_tipo" name="GV_comprobacion_rel_gastos[@contador].concepto_tipo" value="@Bitacoras.Util.GV_comprobacion_origen.GASTO_SIN_COMPROBANTE">
                                                        <td class="input-contador-conceptos"></td>
                                                        <td>@Bitacoras.Util.GV_comprobacion_origen.DescripcionOrigen(concepto.concepto_tipo)</td>
                                                        <td>
                                                            <b>Fecha:</b> <input type="date" class="form-control" name="GV_comprobacion_rel_gastos[@contador].fecha_factura" id="GV_comprobacion_rel_gastos[@contador].fecha_factura" value="@concepto.fecha_factura.Value.ToString("yyyy-MM-dd")" required>
                                                            <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[@contador].fecha_factura data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td nowrap>
                                                            <b>Cuenta:</b>
                                                            <select name="GV_comprobacion_rel_gastos[@contador].id_comprobacion_tipo_gastos_viaje" id="GV_comprobacion_rel_gastos[@contador].id_comprobacion_tipo_gastos_viaje" class="form-control select2bs4" style="width:100%" required>
                                                                <option value=''>-- Seleccione un valor --</option>
                                                                @foreach (var item in listaCuentas)
                                                                {
                                                                    <option value="@item.id" @(concepto.id_comprobacion_tipo_gastos_viaje==item.id ? "selected" : null )>@item.ConcatCuenta</option>
                                                                }
                                                            </select>
                                                            <span class="field-validation-valid text-danger" data-valmsg-for="GV_comprobacion_rel_gastos[@contador].id_comprobacion_tipo_gastos_viaje" data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td nowrap>
                                                            <b>Centro de Costo:</b>
                                                            <select name="GV_comprobacion_rel_gastos[@contador].id_centro_costo" id="GV_comprobacion_rel_gastos[@contador].id_centro_costo" class="form-control select2bs4" style="width:100%" required>
                                                                <option value=''>-- Seleccione un valor --</option>
                                                                @foreach (var planta in listaCentroCosto.Select(x => x.plantas).Distinct())
                                                                {
                                                                    <optgroup label="@planta.descripcion">
                                                                        @foreach (var cc in listaCentroCosto.Where(x => x.clave_planta == planta.clave))
                                                                        {
                                                                            <option value="@cc.id" @(concepto.id_centro_costo==cc.id ? "selected" : null )>@cc.ConcatCentroDeptoPlanta</option>
                                                                        }
                                                                    </optgroup>
                                                                }
                                                            </select>
                                                            <span class="field-validation-valid text-danger" data-valmsg-for="GV_comprobacion_rel_gastos[@contador].id_centro_costo" data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td colspan="1">
                                                            <b>Tipo de Cambio:</b> <input type="text" class="numero-decimal form-control concepto-extranjero" name="GV_comprobacion_rel_gastos[@contador].tipo_cambio" id="GV_comprobacion_rel_gastos[@contador].tipo_cambio" data-row="@contador" value="@concepto.tipo_cambio" required>
                                                            <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[@contador].tipo_cambio data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td colspan="2">
                                                            <b>Moneda:</b>
                                                            <select name="GV_comprobacion_rel_gastos[@contador].currency_iso" id="GV_comprobacion_rel_gastos[@contador].currency_iso" class="form-control select2bs4" style="width:100%" required>
                                                                <option value=''>-- Seleccione un valor --</option>
                                                                <option value="MXN" @(concepto.currency_iso=="MXN" ? "selected" : null )>MXN</option>
                                                                <option value="USD" @(concepto.currency_iso=="USD" ? "selected" : null )>USD</option>
                                                                <option value="EUR" @(concepto.currency_iso=="EUR" ? "selected" : null )>EUR</option>
                                                            </select>
                                                            <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[@contador].currency_iso data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td colspan="8">
                                                        </td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td>
                                                            <textarea style="font-size:12px;" type="text" name="GV_comprobacion_rel_gastos[@contador].comentario" id="GV_comprobacion_rel_gastos[@contador].comentario" class="form-control col-md-12" autocomplete="off" maxlength="150" rows="4">@concepto.comentario</textarea>
                                                            <span class="field-validation-valid text-danger" data-valmsg-for="GV_comprobacion_rel_gastos[@contador].comentario" data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td><input type="button" value="Borrar" class="btn btn-danger" onclick="borrarConcepto(@contador); return false;"></td>
                                                    </tr>
                                                    <!-- Segunda linea-->
                                                    <tr style="background-color: #C9DCC1" class="div_@contador">
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td colspan="2">
                                                            <b>Descripción:</b> <input type="text" class="form-control" name="GV_comprobacion_rel_gastos[@contador].descripcion" id="GV_comprobacion_rel_gastos[@contador].descripcion" maxlength="350" autocomplete="off" value="@concepto.descripcion" required>
                                                            <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[@contador].descripcion data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td nowrap>
                                                            <b>Tipo Pago:</b>
                                                            <select name="GV_comprobacion_rel_gastos[@contador].id_comprobacion_tipo_pago" id="GV_comprobacion_rel_gastos[@contador].id_comprobacion_tipo_pago" class="form-control select2bs4" style="width:100%" required>
                                                                <option value=''>-- Seleccione un valor --</option>
                                                                @foreach (var item in listaTipoPago)
                                                                {
                                                                    <option value="@item.id" @(concepto.id_comprobacion_tipo_pago==item.id ? "selected" : null )>@item.descripcion</option>
                                                                }
                                                            </select>
                                                        </td>
                                                        <td colspan="2"></td>
                                                        <td colspan="3">
                                                            <b>Importe:</b> <input type="text" class="importe form-control concepto-extranjero" name="GV_comprobacion_rel_gastos[@contador].importe" id="GV_comprobacion_rel_gastos[@contador].importe" data-row="@contador" value="@concepto.importe" required>
                                                            <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[@contador].importe data-valmsg-replace="true"></span>
                                                        </td>
                                                        <td colspan="6"></td>
                                                        <td colspan="1"></td>
                                                        <td colspan="1" class="item-total-mxn" id="total-mxn_@contador" style="font-weight: bold; text-align: right;"></td>
                                                        <td colspan="2"></td>
                                                    </tr>
                                                    break;
                                            }
                                            contador++;
                                        }

                                    </tbody>
                                    <tfoot>

                                        <tr>
                                            <th colspan="18" style="text-align:right">Total MXN</th>
                                            <th id="total_gastos_mxn" style="text-align:right" nowrap>$ @string.Format(System.Globalization.CultureInfo.GetCultureInfo("es-US"), "{0:N2}", Model.sumaGastosNacional)</th>
                                            <th colspan="2"></th>
                                        </tr>
                                        <tr>
                                            <th colspan="18" style="text-align:right">ANTICIPO</th>
                                            <th id="anticipo_mxn" style="text-align:right" nowrap>$ @string.Format(System.Globalization.CultureInfo.GetCultureInfo("es-US"), "{0:N2}", Model.sumaGastosNacional)</th>
                                            <th colspan="2"></th>
                                        </tr>
                                        <tr>
                                            <th colspan="18" style="text-align:right">SALDO POR COMPROBAR</th>
                                            <th id="saldo_por_comprobar_mxn" style="text-align:right" nowrap>$ @string.Format(System.Globalization.CultureInfo.GetCultureInfo("es-US"), "{0:N2}", Model.sumaGastosNacional)</th>
                                            <th colspan="2"></th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            <div class="ln_solid"></div>
                            <div class="form-group row">
                                <span style="color:black"><b>CARGAR FACTURA NACIONAL</b></span>
                            </div>
                            <div id="error-msj-div" class="alert alert-danger" role="alert" style="display:none">
                            </div>
                            <div class="form-group row">
                                <span style="color:darkgray"><b>Opci&oacute;n 1 (a trav&eacute;s de COFIDI):</b></span>
                            </div>
                            <div class="item form-group">
                                <label class="control-label col-md-1 float-right">UUID</label>
                                <div class="col-md-4">
                                    <input type="text" id="uuid_field" name="uuid_field" class="form-control" value="" />
                                </div>
                                <div class="col-md-2 col-sm-2">
                                    <button type="button" id="buscar-uuid" class="btn btn-warning float-lg-left"><i class="fa-solid fa-magnifying-glass"></i>&nbsp; Buscar</button>
                                </div>
                            </div>
                            <div class="form-group row">
                                <span style="color:darkgray"><b>Opci&oacute;n 2 (Carga de archivo .xml):</b></span>
                            </div>
                            <div class="item form-group">
                                <label for="archivo_nacional_xml" class="control-label col-md-1">XML</label>
                                <div class="col-md-4">
                                    <div class="input-group">
                                        <div class="custom-file">
                                            <input type="file" id="archivo_nacional_xml" name="archivo_nacional_xml" class="custom-file-input" accept=".xml,.XML" />
                                            <label class="custom-file-label" for="archivo_nacional_xml" style="text-align:left">Seleccione un archivo...</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-2 col-sm-2">
                                    <button id="cargar-factura-btn" type="button" class="btn btn-warning float-lg-left"><i class="fa-solid fa-upload"></i>&nbsp; Leer Factura</button>
                                </div>
                            </div>
                            <div class="ln_solid"></div>
                            <div class="form-group row">
                                <span style="color:black"><b>OTROS TIPOS DE CONCEPTOS</b></span>
                            </div>
                            <div class="item form-group">
                                <div class="col-md-2 col-sm-2">
                                    <button id="cargar-factura-extranjera-btn" type="button" class="btn btn-warning float-lg-left"><i class="fa-solid fa-plus"></i>&nbsp; Comprobante Extranjero</button>
                                </div>

                                <div class="col-md-2 col-sm-2">
                                    <button id="cargar-concepto-sin-factura-btn" type="button" class="btn btn-warning float-lg-left"><i class="fa-solid fa-plus"></i>&nbsp; Concepto Sin Factura </button>
                                </div>
                            </div>
                            <div class="ln_solid"></div>
                            <div class="form-group row">
                                <span style="color:black"><b>COMENTARIOS ADICIONALES</b></span>
                            </div>
                            <div class="item form-group">
                                @Html.LabelFor(model => model.GV_comprobacion.comentario_adicional, new { @class = "control-label col-md-12 col-sm-12", @style = "text-align:left" })
                            </div>
                            <div class="item form-group">
                                <div class="col-md-12">
                                    @Html.TextAreaFor(model => model.GV_comprobacion.comentario_adicional, new { @class = "form-control", @rows = "4", @autocomplete = "off" })
                                    @Html.ValidationMessageFor(model => model.GV_comprobacion.comentario_adicional, "", new { @class = "text-danger" })
                                </div>
                            </div>
                            <div class="ln_solid"></div>
                            <div class="form-group row">
                            <span style="color:black"><b>MOVIMIENTOS</b></span>
                            </div>

                        <div class="form-group row">
                            <!-- Solicitante -->
                            @Html.LabelFor(model => model.id_solicitante, new { @class = "control-label col-md-1" })
                            <input type="text" class="form-control col-md-5" value="@Html.DisplayFor(model => model.empleados5.ConcatNombre)" readonly>
                            <!-- Fecha validadcion -->
                            @Html.LabelFor(model => model.GV_comprobacion.fecha_comprobacion, new { @class = "control-label col-md-2 float-right" })
                            <div class="col-md-4">
                                <input type="text" class="form-control col-md-12" value="@(Model.GV_comprobacion.fecha_comprobacion.HasValue ? Model.GV_comprobacion.fecha_comprobacion.Value.ToString() : "NO DISPONIBLE" )" readonly>
                            </div>
                        </div>
                        <div class="form-group row">
                            <!-- JEFE DIRECTO -->
                            @Html.LabelFor(model => model.GV_comprobacion.id_jefe_directo, new { @class = "control-label col-md-1" })
                            <input type="text" class="form-control col-md-5" value="@Html.DisplayFor(model => model.GV_comprobacion.empleados2.ConcatNombre)" readonly>

                            <!-- Fecha validacion -->
                            @Html.LabelFor(model => model.GV_comprobacion.fecha_aceptacion_jefe_area, new { @class = "control-label col-md-2 float-right" })

                            <div class="col-md-4">
                                @if (Model.GV_comprobacion.fecha_aceptacion_jefe_area.HasValue)
                                {
                                    <input type="text" class="form-control col-md-12" value="@Model.GV_comprobacion.fecha_aceptacion_jefe_area.Value" readonly>
                                }
                                else if (Model.GV_comprobacion.estatus == Bitacoras.Util.GV_comprobacion_estatus.RECHAZADO_JEFE)
                                {
                                    <input type="text" class="form-control col-md-12" value="RECHAZADO" readonly>
                                }
                                else
                                {
                                    <input type="text" class="form-control col-md-12" value="NO DISPONIBLE" readonly>
                                }
                            </div>
                        </div>
                        <div class="form-group row">
                            <!-- CONTROLLING -->
                            @Html.LabelFor(model => model.GV_comprobacion.id_controlling, new { @class = "control-label col-md-1" })
                            <input type="text" class="form-control col-md-5" value="@Html.DisplayFor(model => model.GV_comprobacion.empleados1.ConcatNombre)" readonly>

                            <!-- Fecha validacion -->
                            @Html.LabelFor(model => model.GV_comprobacion.fecha_aceptacion_controlling, new { @class = "control-label col-md-2 float-right" })

                            <div class="col-md-4">
                                @if (Model.GV_comprobacion.fecha_aceptacion_controlling.HasValue)
                                {
                                    <input type="text" class="form-control col-md-12" value="@Model.GV_comprobacion.fecha_aceptacion_controlling.Value" readonly>
                                }
                                else if (Model.GV_comprobacion.id_controlling.HasValue && Model.GV_comprobacion.estatus == Bitacoras.Util.GV_comprobacion_estatus.RECHAZADO_CONTROLLING)
                                {
                                    <input type="text" class="form-control col-md-12" value="RECHAZADO" readonly>
                                }
                                else
                                {
                                    <input type="text" class="form-control col-md-12" value="NO DISPONIBLE" readonly>
                                }
                            </div>
                        </div>
                        <div class="form-group row">
                            <!-- CONTABILIDAD -->
                            @Html.LabelFor(model => model.GV_comprobacion.id_contabilidad, new { @class = "control-label col-md-1" })
                            <input type="text" class="form-control col-md-5" value="@Html.DisplayFor(model => model.GV_comprobacion.empleados.ConcatNombre)" readonly>

                            <!-- Fecha validacion -->
                            @Html.LabelFor(model => model.GV_comprobacion.fecha_aceptacion_contabilidad, new { @class = "control-label col-md-2 float-right" })
                            <div class="col-md-4">
                                @if (Model.GV_comprobacion.fecha_aceptacion_contabilidad.HasValue)
                                {
                                    <input type="text" class="form-control col-md-12" value="@Model.GV_comprobacion.fecha_aceptacion_contabilidad.Value" readonly>
                                }
                                else if (Model.GV_comprobacion.id_contabilidad.HasValue && Model.GV_comprobacion.estatus == Bitacoras.Util.GV_comprobacion_estatus.RECHAZADO_CONTABILIDAD)
                                {
                                    <input type="text" class="form-control col-md-12" value="RECHAZADO" readonly>
                                }
                                else
                                {
                                    <input type="text" class="form-control col-md-12" value="NO DISPONIBLE" readonly>
                                }
                            </div>
                        </div>
                        <div class="form-group row">
                            <!-- NOMINA -->
                            @Html.LabelFor(model => model.GV_comprobacion.id_nomina, new { @class = "control-label col-md-1" })
                            <input type="text" class="form-control col-md-5" value="@Html.DisplayFor(model => model.GV_comprobacion.empleados3.ConcatNombre)" readonly>

                            <!-- Fecha validacion -->
                            @Html.LabelFor(model => model.GV_comprobacion.fecha_aceptacion_nomina, new { @class = "control-label col-md-2 float-right" })
                            <div class="col-md-4">
                                @if (Model.GV_comprobacion.fecha_aceptacion_nomina.HasValue)
                                {
                                    <input type="text" class="form-control col-md-12" value="@Model.GV_comprobacion.fecha_aceptacion_nomina.Value" readonly>
                                }
                                else if (Model.GV_comprobacion.id_nomina.HasValue && Model.GV_comprobacion.estatus == Bitacoras.Util.GV_comprobacion_estatus.RECHAZADO_NOMINA)
                                {
                                    <input type="text" class="form-control col-md-12" value="RECHAZADO" readonly>
                                }
                                else
                                {
                                    <input type="text" class="form-control col-md-12" value="NO DISPONIBLE" readonly>
                                }
                            </div>
                        </div>

                        <div class="ln_solid"></div>
                            <div class="item form-group">
                                <div class="col-md-12 col-sm-12 offset-md-12">
                                    <button type="submit" class="btn btn-success btn-lg float-lg-right"> <i class="fa-regular fa-floppy-disk"></i>&nbsp; Guardar</button>
                                </div>
                            </div>
                        }
                    </div>
                </div>
                <div>
                    <br />
                    <a href="javascript: history.go(-1)" class="btn btn-round btn-info btm-sm" title="Volver">
                        <i class="fa fa-arrow-circle-left"></i> Volver
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="select_cuentas" style="display:none">
    <select name="GV_comprobacion_rel_gastos[#ID].id_comprobacion_tipo_gastos_viaje" id="GV_comprobacion_rel_gastos[#ID].id_comprobacion_tipo_gastos_viaje" class="form-control select2bs4" style="width:100%" required>
        <option value=''>-- Seleccione un valor --</option>
        @foreach (var item in listaCuentas)
        {
            <option value="@item.id">@item.ConcatCuenta</option>
        }
    </select>
    <span class="field-validation-valid text-danger" data-valmsg-for="GV_comprobacion_rel_gastos[#ID].id_comprobacion_tipo_gastos_viaje" data-valmsg-replace="true"></span>
</div>
<div id="select_centros_costo" style="display:none">
    <select name="GV_comprobacion_rel_gastos[#ID].id_centro_costo" id="GV_comprobacion_rel_gastos[#ID].id_centro_costo" class="form-control select2bs4" style="width:100%" required>
        <option value=''>-- Seleccione un valor --</option>
        @foreach (var planta in listaCentroCosto.Select(x => x.plantas).Distinct())
        {

            <optgroup label="@planta.descripcion">
                @foreach (var cc in listaCentroCosto.Where(x => x.clave_planta == planta.clave))
                {
                    <option value="@cc.id">@cc.ConcatCentroDeptoPlanta</option>
                }
            </optgroup>
        }
    </select>
    <span class="field-validation-valid text-danger" data-valmsg-for="GV_comprobacion_rel_gastos[#ID].id_centro_costo" data-valmsg-replace="true"></span>
</div>
<div id="select_tipo_pago" style="display:none">
    <select name="GV_comprobacion_rel_gastos[#ID].id_comprobacion_tipo_pago" id="GV_comprobacion_rel_gastos[#ID].id_comprobacion_tipo_pago" class="form-control select2bs4" style="width:100%" required>
        <option value=''>-- Seleccione un valor --</option>
        @foreach (var item in listaTipoPago)
        {
            <option value="@item.id">@item.descripcion</option>
        }
    </select>
    <span class="field-validation-valid text-danger" data-valmsg-for="GV_comprobacion_rel_gastos[#ID].id_comprobacion_tipo_pago" data-valmsg-replace="true"></span>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render(Url.Content("~/Content/vendors/jquery-iu/jquery-ui.min.js"))
    @Scripts.Render(Url.Content("~/Scripts/MvcFoolproofJQueryValidation.js"))
    @Scripts.Render(Url.Content("~/Content/vendors/select2/js/select2.full.min.js"))
    @Scripts.Render("~/bundles/dataTables_js")
    @Scripts.Render(Url.Content("~/Content/vendors/moment/moment.js"))
    @Scripts.Render(Url.Content("~/Content/vendors/sweetalert2/sweetalert2@11.js"))
    <!-- iCheck -->
    @Scripts.Render(Url.Content("~/Content/vendors/iCheck/icheck.min.js"))
    <!-- input mask -->
    @Scripts.Render(Url.Content("~/Content/vendors/jquery.inputmask/dist/jquery.inputmask.bundle.js"))
    @Scripts.Render(Url.Content("~/Content/vendors/jquery.inputmask/dist/inputmask/inputmask.extensions.js"))
    <script src="https://cdn.jsdelivr.net/npm/bs-custom-file-input/dist/bs-custom-file-input.min.js"></script>

    <script>
        $(document).ready(function () {
    //inicializa en input file
    bsCustomFileInput.init();

    // Initialize Select2 Elements (debe ir después de asignar el valor)
    $('.select2bs4').select2({
        theme: 'bootstrap4'
    })

    $('input').iCheck({
        checkboxClass: 'icheckbox_square-green',
        radioClass: 'iradio_square-green',
        increaseArea: '20%' // optional
    });

    //agrega evento para cambio de empleado
    calculaDias();

    //input mask
    $('.precio').inputmask({ 'alias': 'decimal', 'groupSeparator': ',', 'autoGroup': true, 'digits': 2, 'digitsOptional': false, 'prefix': '$ ', 'allowMinus': false, 'placeholder': '0', 'autoUnmask': true, 'removeMaskOnSubmit': true });
    $('.cantidad').inputmask({ 'alias': 'decimal', 'groupSeparator': ',', 'autoGroup': true, 'digits': 2, 'digitsOptional': false, 'allowMinus': false, 'placeholder': '0', 'autoUnmask': true, 'removeMaskOnSubmit': true });
    $('#@Html.IdFor(model => model.GV_comprobacion.business_card)').inputmask({ 'mask': '9999-9999-9999-9999', 'autoGroup': true, 'autoUnmask': true, 'removeMaskOnSubmit': true });
    $('#uuid_field').inputmask({ 'mask': '********-****-****-****-************', 'autoGroup': true, 'autoUnmask': true, 'removeMaskOnSubmit': true });


    //evento para leer el archivo xml
    $("#cargar-factura-btn").click(function () {
        leeXML();
    });

    //evento para buscar uuid desde cofidi
    $("#buscar-uuid").click(function () {
        BuscaXML();
    });

    //evento para agregar factura extranjera
    $("#cargar-factura-extranjera-btn").click(function () {
        AgregaConceptoExtranjero();
    });

    //evento para agregar concepto sin factura
    $("#cargar-concepto-sin-factura-btn").click(function () {
        AgregaConceptoSinFactura();
    });

    //al cargar la página por primera vez
    /*  verificaEstadoCombos();*/
    AsignaNumeroConcepto();
    asignaEventosInput();
    CargaValoresIniciales();

});

function CalculaTotales() {

    let totalMXN = 0;
    $(".item-total-mxn").each(function () {
        let cantidad = $(this).html();
        totalMXN += CurrencyToFloat(cantidad);
    });

    $("#total_gastos_mxn").html(FloatToCurrency(totalMXN));


    //calcula el valor por comprobar
    let anticipoMXN = CurrencyToFloat($("#anticipo_mxn").html());
    let porComprobarMXN = anticipoMXN - totalMXN;
    // muestra la cantidad por comprobar
    $("#saldo_por_comprobar_mxn").html(FloatToCurrency(porComprobarMXN));


}

function CurrencyToFloat(currency) {
    let c = currency.replace('$', '').replace(',', '').replace(',', '');
    return TryParseFloat(c, 0);
}
function FloatToCurrency(currency) {
    //aplica formato de moneda
    const resultd = (currency).toLocaleString('en-US', {
        style: 'currency',
        currency: 'USD'
    });
    return resultd;
}

function CargaValoresIniciales() {
    //agrega evento para calculo de gasto extranjero
    $(".concepto-extranjero").each(function () {
        let row = $(this).attr("data-row");
        let tipoCambio = document.getElementById("GV_comprobacion_rel_gastos[" + row + "].tipo_cambio").value;
        let importe = document.getElementById("GV_comprobacion_rel_gastos[" + row + "].importe").value;

        let totalmxn = TryParseFloat(tipoCambio, 0) * TryParseFloat(importe, 0);

        //aplica formato de moneda
        const resultd = (totalmxn).toLocaleString('en-US', {
            style: 'currency',
            currency: 'USD'
        });

        //asigna el valor a la tabla
        $('#total-mxn_' + row).html(resultd);
    });

    CalculaTotales();
}

//funcion para agregar los eventos de cantidades a los input
function asignaEventosInput() {
    //Agrega el evento a todos los input
    $("input:file").each(function () {
        $(this).on('input', function (e) {
            document.getElementById('cambio_documento_formulario').value = ++documento_soporte_cambios;
        });
    });

    //aplica los estilos a los input
    $('.numero-decimal').inputmask({ 'alias': 'decimal', 'groupSeparator': ',', 'autoGroup': true, 'digits': 2, 'digitsOptional': false, 'allowMinus': false, 'placeholder': '0', 'autoUnmask': true, 'removeMaskOnSubmit': true });
    $('.importe').inputmask({ 'alias': 'decimal', 'groupSeparator': ',', 'autoGroup': true, 'digits': 2, 'digitsOptional': false, 'prefix': '$ ', 'allowMinus': false, 'placeholder': '0', 'autoUnmask': true, 'removeMaskOnSubmit': true });

    //agrega evento para calculo de gasto extranjero
    $(".concepto-extranjero").each(function () {

        $(this).on('keyup change blur', function (e) {
            let row = $(this).attr("data-row");
            let tipoCambio = document.getElementById("GV_comprobacion_rel_gastos[" + row + "].tipo_cambio").value;
            let importe = document.getElementById("GV_comprobacion_rel_gastos[" + row + "].importe").value;

            let totalmxn = TryParseFloat(tipoCambio, 0) * TryParseFloat(importe, 0);

            //aplica formato de moneda
            const resultd = (totalmxn).toLocaleString('en-US', {
                style: 'currency',
                currency: 'USD'
            });

            //asigna el valor a la tabla
            $('#total-mxn_' + row).html(resultd);

            CalculaTotales();
        });
    });

    //Evento cada vez que se cambia un combo
    $(".cuenta").each(function () {

        $(this).change(function (e) {
            let uuid_select = $(this).attr("data-uuid");
            let val = $(this).val();

            $(".cuenta").each(function () {

                let secondUUID = $(this).attr("data-uuid");
                if (uuid_select == secondUUID) {
                    $(this).val(val);
                    // Initialize Select2 Elements (debe ir después de asignar el valor)
                    if ($(this) != null) {
                        $(this).select2({
                            theme: 'bootstrap4'
                        })
                    }
                }
            });
        });
    });
    //Evento cada vez que se cambia un combo
    $(".centro-costo").each(function () {

        $(this).change(function (e) {
            let uuid_select = $(this).attr("data-uuid");
            let val = $(this).val();

            $(".centro-costo").each(function () {

                let secondUUID = $(this).attr("data-uuid");
                if (uuid_select == secondUUID) {
                    $(this).val(val);
                    // Initialize Select2 Elements (debe ir después de asignar el valor)
                    if ($(this) != null) {
                        $(this).select2({
                            theme: 'bootstrap4'
                        })
                    }
                }
            });
        });
    });
    //Evento cada vez que se cambia un combo
    $(".tipo-pago").each(function () {

        $(this).change(function (e) {
            let uuid_select = $(this).attr("data-uuid");
            let val = $(this).val();

            $(".tipo-pago").each(function () {

                let secondUUID = $(this).attr("data-uuid");
                if (uuid_select == secondUUID) {
                    $(this).val(val);
                    // Initialize Select2 Elements (debe ir después de asignar el valor)
                    if ($(this) != null) {
                        $(this).select2({
                            theme: 'bootstrap4'
                        })
                    }
                }
            });
        });
    });

}

//funcion para agregar concepto sin factura
function AgregaConceptoSinFactura() {
    $("#body_conceptos").append(
        `
                                        <tr style="background-color:#FFEB9C" class="div_`+ numConcepto + `">
                                            <input type="hidden" name="GV_comprobacion_rel_gastos.Index" id="GV_comprobacion_rel_gastos.Index" value="`+ numConcepto + `" />
                                            <input type="hidden" id="GV_comprobacion_rel_gastos[`+ numConcepto + `].concepto_tipo" name="GV_comprobacion_rel_gastos[` + numConcepto + `].concepto_tipo" value="@Bitacoras.Util.GV_comprobacion_origen.GASTO_SIN_COMPROBANTE">
                                            <td class="input-contador-conceptos"></td>
                                            <td>@Bitacoras.Util.GV_comprobacion_origen.DescripcionOrigen(Bitacoras.Util.GV_comprobacion_origen.GASTO_SIN_COMPROBANTE)</td>
                                            <td>
                                                <b>Fecha:</b> <input type="date" class="form-control" name="GV_comprobacion_rel_gastos[`+ numConcepto + `].fecha_factura" id="GV_comprobacion_rel_gastos[` + numConcepto + `].fecha_factura" required>
                                                    <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[`+ numConcepto + `].fecha_factura data-valmsg-replace="true"></span>
                                            </td>
                                            <td nowrap><b>Cuenta:</b>`+ textoSelectCuentas.replace('#ID', numConcepto).replace('#ID', numConcepto).replace('#ID', numConcepto) + `</td>
                                            <td nowrap><b>Centro Costo:</b>`+ textoSelectCC.replace('#ID', numConcepto).replace('#ID', numConcepto).replace('#ID', numConcepto) + `</td>
                                            <td colspan="1">
                                                <b>Tipo de Cambio:</b> <input type="text" class="numero-decimal form-control concepto-extranjero" data-row="`+ numConcepto + `" name="GV_comprobacion_rel_gastos[` + numConcepto + `].tipo_cambio" id="GV_comprobacion_rel_gastos[` + numConcepto + `].tipo_cambio" value="1.00" required>
                                                 <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[`+ numConcepto + `].tipo_cambio data-valmsg-replace="true"></span>
                                            </td>
                                             <td colspan="2">
                                                <b>Moneda:</b>
                                                    <select name="GV_comprobacion_rel_gastos[`+ numConcepto + `].currency_iso" id="GV_comprobacion_rel_gastos[` + numConcepto + `].currency_iso" class="form-control select2bs4" style="width:100%" required>
                                                        <option value=''>-- Seleccione un valor --</option>
                                                        <option value="MXN" selected>MXN</option>
                                                        <option value="USD">USD</option>
                                                        <option value="EUR">EUR</option>
                                                    </select>
                                                <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[`+ numConcepto + `].currency_iso data-valmsg-replace="true"></span>
                                            </td>
                                            <td colspan="8">

                                            </td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td>
                                                <textarea style="font-size:12px;" type="text" name="GV_comprobacion_rel_gastos[`+ numConcepto + `].comentario" id="GV_comprobacion_rel_gastos[` + numConcepto + `].comentario" class="form-control col-md-12" autocomplete="off" maxlength="150" rows="4"></textarea>
                                                <span class="field-validation-valid text-danger" data-valmsg-for="GV_comprobacion_rel_gastos[`+ numConcepto + `].comentario" data-valmsg-replace="true"></span>
                                            </td>
                                            <td><input type="button" value="Borrar" class="btn btn-danger" onclick="borrarConcepto(`+ numConcepto + `); return false;"></td>
                                        </tr>

                                        `
    );

    $("#body_conceptos").append(
        `
                                        <tr  style="background-color:#C9DCC1" class="div_`+ (numConcepto) + `">
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td colspan="2">
                                                <b>Descripción:</b> <input type="text" class="form-control" name="GV_comprobacion_rel_gastos[`+ numConcepto + `].descripcion" id="GV_comprobacion_rel_gastos[` + numConcepto + `].descripcion" maxlength="350" autocomplete="off" required>
                                                 <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[`+ numConcepto + `].descripcion data-valmsg-replace="true"></span>
                                            </td>
                                            <td nowrap><b>Tipo Pago:</b>`+ textoSelectTipoPago.replace('#ID', numConcepto).replace('#ID', numConcepto).replace('#ID', numConcepto) + `</td>
                                            <td colspan="2"></td>
                                            <td colspan="3">
                                                <b>Importe:</b> <input type="text" class="importe form-control concepto-extranjero" name="GV_comprobacion_rel_gastos[`+ numConcepto + `].importe" id="GV_comprobacion_rel_gastos[` + numConcepto + `].importe" data-row="` + numConcepto + `" required>
                                                 <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[`+ numConcepto + `].importe data-valmsg-replace="true"></span>
                                            </td>
                                            <td colspan="6"></td>
                                            <td colspan="1"></td>
                                            <td colspan="1" class="item-total-mxn" id="total-mxn_`+ numConcepto + `" style="font-weight:bold; text-align: right;"></td>
                                            <td colspan="2"></td>
                                        </tr>
                                        `
    );

    ////inicializa en input file
    //bsCustomFileInput.init();

    //agrega evento para cambios en asigna eventos
    asignaEventosInput();

    //Aumenta el número de concepto en 1
    numConcepto++;
    //aumenta en uno el número de comprobantes cargados
    AsignaNumeroConcepto();

    // Initialize Select2 Elements (debe ir después de asignar el valor)
    $('.select2bs4').select2({
        theme: 'bootstrap4'
    })

    Toast.fire({
        icon: 'success',
        title: 'Mensaje',
        text: 'Se agregó una fila para comprobante sin factura. Favor de completar los datos.',
        timer: '2500'
    })
}

//funcion para agregar concepto extranjero
function AgregaConceptoExtranjero() {

    $("#body_conceptos").append(
        `
                                        <tr style="background-color:#FFEB9C" class="div_`+ numConcepto + `">
                                            <input type="hidden" name="GV_comprobacion_rel_gastos.Index" id="GV_comprobacion_rel_gastos.Index" value="`+ numConcepto + `" />
                                            <input type="hidden" id="GV_comprobacion_rel_gastos[`+ numConcepto + `].concepto_tipo" name="GV_comprobacion_rel_gastos[` + numConcepto + `].concepto_tipo" value="@Bitacoras.Util.GV_comprobacion_origen.GASTO_EXTRANJERO">
                                            <td class="input-contador-conceptos"></td>
                                            <td>@Bitacoras.Util.GV_comprobacion_origen.DescripcionOrigen(Bitacoras.Util.GV_comprobacion_origen.GASTO_EXTRANJERO)</td>
                                            <td>
                                                <b>Fecha:</b> <input type="date" class="form-control" name="GV_comprobacion_rel_gastos[`+ numConcepto + `].fecha_factura" id="GV_comprobacion_rel_gastos[` + numConcepto + `].fecha_factura" required>
                                                    <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[`+ numConcepto + `].fecha_factura data-valmsg-replace="true"></span>
                                            </td>
                                            <td nowrap><b>Cuenta:</b>`+ textoSelectCuentas.replace('#ID', numConcepto).replace('#ID', numConcepto).replace('#ID', numConcepto) + `</td>
                                            <td nowrap><b>Centro Costo:</b>`+ textoSelectCC.replace('#ID', numConcepto).replace('#ID', numConcepto).replace('#ID', numConcepto) + `</td>
                                            <td colspan="1">
                                                <b>Tipo de Cambio:</b> <input type="text" class="numero-decimal form-control concepto-extranjero" data-row="`+ numConcepto + `" name="GV_comprobacion_rel_gastos[` + numConcepto + `].tipo_cambio" id="GV_comprobacion_rel_gastos[` + numConcepto + `].tipo_cambio" value="1.00" required>
                                                 <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[`+ numConcepto + `].tipo_cambio data-valmsg-replace="true"></span>
                                            </td>
                                             <td colspan="2">
                                                <b>Moneda:</b>
                                                    <select name="GV_comprobacion_rel_gastos[`+ numConcepto + `].currency_iso" id="GV_comprobacion_rel_gastos[` + numConcepto + `].currency_iso" class="form-control select2bs4" style="width:100%" required>
                                                        <option value=''>-- Seleccione un valor --</option>
                                                        <option value="USD">USD</option>
                                                        <option value="EUR">EUR</option>
                                                    </select>
                                                <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[`+ numConcepto + `].currency_iso data-valmsg-replace="true"></span>
                                            </td>
                                            <td colspan="8">
                                                <b>Comprobante:</b>
                                                <div class="col-md-11">
                                                    <div class="input-group">
                                                        <div class="custom-file">
                                                            <input type="file" id="GV_comprobacion_rel_gastos[`+ numConcepto + `].PostedFileExtranjero" name="GV_comprobacion_rel_gastos[` + numConcepto + `].PostedFileExtranjero" class="custom-file-input" accept=".png,.PNG, .jpeg, .JPEG, .png, .PNG, .rar, .RAR, .ZIP, .zip, .pdf, .PDF, .xml, .XML" required />
                                                            <label class="custom-file-label" for="GV_comprobacion_rel_gastos[`+ numConcepto + `].PostedFileExtranjero" style="text-align:left">Seleccione un archivo...</label>
                                                        </div>
                                                    </div>
                                                    <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[`+ numConcepto + `].PostedFileExtranjero data-valmsg-replace=" true"></span>
                                                </div>
                                            </td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td>
                                                <textarea style="font-size:12px;" type="text" name="GV_comprobacion_rel_gastos[`+ numConcepto + `].comentario" id="GV_comprobacion_rel_gastos[` + numConcepto + `].comentario" class="form-control col-md-12" autocomplete="off" maxlength="150" rows="4"></textarea>
                                                <span class="field-validation-valid text-danger" data-valmsg-for="GV_comprobacion_rel_gastos[`+ numConcepto + `].comentario" data-valmsg-replace="true"></span>
                                            </td>
                                            <td><input type="button" value="Borrar" class="btn btn-danger" onclick="borrarConcepto(`+ numConcepto + `); return false;"></td>
                                        </tr>

                                        `
    );

    $("#body_conceptos").append(
        `
                                        <tr  style="background-color:#C9DCC1" class="div_`+ (numConcepto) + `">
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td colspan="2">
                                                <b>Descripción:</b> <input type="text" class="form-control" name="GV_comprobacion_rel_gastos[`+ numConcepto + `].descripcion" id="GV_comprobacion_rel_gastos[` + numConcepto + `].descripcion" maxlength="350" autocomplete="off" required>
                                                 <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[`+ numConcepto + `].descripcion data-valmsg-replace="true"></span>
                                            </td>
                                            <td nowrap><b>Tipo Pago:</b>`+ textoSelectTipoPago.replace('#ID', numConcepto).replace('#ID', numConcepto).replace('#ID', numConcepto) + `</td>
                                            <td colspan="2"></td>
                                            <td colspan="3">
                                                <b>Importe:</b> <input type="text" class="importe form-control concepto-extranjero" name="GV_comprobacion_rel_gastos[`+ numConcepto + `].importe" id="GV_comprobacion_rel_gastos[` + numConcepto + `].importe" data-row="` + numConcepto + `" required>
                                                 <span class=" field-validation-valid text-danger control-label" data-valmsg-for=GV_comprobacion_rel_gastos[`+ numConcepto + `].importe data-valmsg-replace="true"></span>
                                            </td>
                                            <td colspan="6"></td>
                                            <td colspan="1"></td>
                                            <td colspan="1" class="item-total-mxn" id ="total-mxn_`+ numConcepto + `" style="font-weight:bold; text-align: right"></td>
                                            <td colspan="2"></td>
                                        </tr>
                                        `
    );


    //inicializa en input file
    bsCustomFileInput.init();

    //agrega evento para cambios en asigna eventos
    asignaEventosInput();

    //Aumenta el número de concepto en 1
    numConcepto++;
    //aumenta en uno el número de comprobantes cargados
    AsignaNumeroConcepto();

    // Initialize Select2 Elements (debe ir después de asignar el valor)
    $('.select2bs4').select2({
        theme: 'bootstrap4'
    })

    Toast.fire({
        icon: 'success',
        title: 'Mensaje',
        text: 'Se agregó una fila para comprobante extranjero. Favor de completar los datos.',
        timer: '2500'
    })
}

//variables utilizadas para numeración de conceptos y facturas
var numConcepto = 200;
//variable para saber si ha cambiado el formulario y asi no se detenga por doble submit
var documento_soporte_cambios = 1;

//variable global de los select
var textoSelectCuentas = obtieneSelectCuentas();
var textoSelectCC = obtieneSelectCC();
var textoSelectTipoPago = obtieneSelectTipoPago();

const Toast = Swal.mixin({
    toast: true,
    position: 'top-right',
    iconColor: 'white',
    customClass: {
        popup: 'colored-toast'
    },
    showConfirmButton: false,
    timer: 4000,
    timerProgressBar: true
})

function obtieneSelectCuentas() {
    return $("#select_cuentas").html();
}
function obtieneSelectCC() {
    return $("#select_centros_costo").html();
}
function obtieneSelectTipoPago() {
    return $("#select_tipo_pago").html();
}

function leeXML() {
    //var f = $(this);
    var formData = new FormData(document.getElementById("formulario"));
    formData.append("numConcepto", numConcepto);
    $.ajax({
        url: "/ComprobacionGV/LeeArchivoXML",
        type: "post",
        dataType: "html",
        data: formData,
        cache: false,
        contentType: false,
        processData: false,
        success: function (data) {
            try {
                //convierte la respuesta en archivo json
                let datos = JSON.parse(data)
                let estatus = datos[0].status;

                //verifica si se leyó correctamente el archivo xlsx
                if (estatus == "ERROR") {
                    $("#error-msj-div").html(datos[0].value);
                    $("#error-msj-div").hide().show('slide', 300);
                    $("#info-msj-div").hide();
                    //borra la tabla
                    $("#div_ocultos").html('');
                    //recargaTabla('');
                    //$("#archivo_nacional_xml").val('');
                    //$('#archivo_nacional_xml').next('label').html('Seleccione un archivo...');
                    //$("#archivo_nacional_pdf").val('');
                    //$('#archivo_nacional_pdf').next('label').html('Seleccione un archivo...');

                } else if (datos[0].status == "OK") {
                    //verifica si el uuid leido ya existe en la tabla

                    if (ExisteUUID(datos[0].uuid)) {
                        Swal.fire({
                            icon: 'warning',
                            title: 'Mensaje',
                            text: 'El UUID ya ha sido agregado a la comprobación. Favor de verificar los datos.'
                        })
                    } else { //si no existe el uuid en la tabla, lo agrega
                        AgregaConcepto(datos[0].value);

                        Toast.fire({
                            icon: 'success',
                            title: 'Mensaje',
                            text: 'Se cargó correctamente. ' + datos[0].msj + ' Favor de verificar los datos.'
                        })

                        $("#error-msj-div").hide();

                        //borra el archivo una vez que se ha cargado
                        $("#archivo_nacional_xml").val('');
                        $('#archivo_nacional_xml').next('label').html('Seleccione un archivo...');
                        //$("#archivo_nacional_pdf").val('');
                        //$('#archivo_nacional_pdf').next('label').html('Seleccione un archivo...');

                        $('.select2bs4').select2({
                            theme: 'bootstrap4'
                        })

                        //inicializa en input file
                        bsCustomFileInput.init();

                        asignaEventosInput();

                        numConcepto += datos[0].num_conceptos;
                        //aumenta en uno el número de comprobantes cargados
                        AsignaNumeroConcepto();
                    }

                } else if (datos[0].status == "404") {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Mensaje',
                        text: 'No se encontró una factura asociada. Verifique los datos y/o ingrese la factura de forma manual.',
                        confirmButtonText: 'Aceptar',
                    })
                    $("#error-msj-div").hide();
                    //borra el archivo una vez que se ha cargado
                    $("#archivo_nacional_xml").val('');
                    $('#archivo_nacional_xml').next('label').html('Seleccione un archivo...');
                    //$("#archivo_nacional_pdf").val('');
                    //$('#archivo_nacional_pdf').next('label').html('Seleccione un archivo...');
                }

            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Ocurrió un error obteniendo la información: ' + error,
                    confirmButtonText: 'Aceptar',
                })
                $("#archivo_nacional_xml").val('');
                $('#archivo_nacional_xml').next('label').html('Seleccione un archivo...');
                $("#archivo_nacional_pdf").val('');
                $('#archivo_nacional_pdf').next('label').html('Seleccione un archivo...');
            }

        },
        error: function (textStatus, errorThrown) {
            //en caso de error en la llamada ajax
            Swal.fire({
                icon: 'error',
                title: 'Ocurrió un error: ' + errorThrown,
                text: 'Intente nuevamente.'
            })
        },
        async: true

    });
}

function BuscaXML() {
    //var f = $(this);

    var formData = new FormData(document.getElementById("formulario"));
    formData.append("numConcepto", numConcepto);

    //verifica si existe el uuid
    let uuid = $("#uuid_field").val();
    var existeUUID = ExisteUUID(uuid);

    if (existeUUID) {
        Swal.fire({
            icon: 'warning',
            title: 'Mensaje',
            text: 'El UUID ya ha sido agregado a la comprobación. Favor de verificar los datos.'
        })
    } else {

        $.ajax({
            url: "/ComprobacionGV/BuscaCOFIDI",
            type: "post",
            dataType: "html",
            data: formData,
            cache: false,
            contentType: false,
            processData: false,
            success: function (data) {
                try {
                    //convierte la respuesta en archivo json
                    let datos = JSON.parse(data)
                    let estatus = datos[0].status;

                    //verifica si se leyó correctamente el archivo xlsx
                    if (estatus == "ERROR") {
                        $("#error-msj-div").html(datos[0].value);
                        $("#error-msj-div").hide().show('slide', 300);
                        $("#info-msj-div").hide();
                        //borra la tabla
                        $("#div_ocultos").html('');
                        //recargaTabla('');
                        $("#archivo_nacional_xml").val('');
                        $('#archivo_nacional_xml').next('label').html('Seleccione un archivo...');
                        $("#archivo_nacional_pdf").val('');
                        $('#archivo_nacional_pdf').next('label').html('Seleccione un archivo...');

                    } else if (datos[0].status == "OK") {

                        //console.log(datos[0].value);

                        AgregaConcepto(datos[0].value);

                        Toast.fire({
                            icon: 'success',
                            title: 'Mensaje',
                            text: 'Se cargó correctamente. Verifique los datos.'
                        })

                        $("#error-msj-div").hide();
                        //borra el archivo una vez que se ha cargado
                        $("#archivo_nacional_xml").val('');
                        $('#archivo_nacional_xml').next('label').html('Seleccione un archivo...');
                        $("#archivo_nacional_pdf").val('');
                        $('#archivo_nacional_pdf').next('label').html('Seleccione un archivo...');

                        $('.select2bs4').select2({
                            theme: 'bootstrap4'
                        })

                        numConcepto += datos[0].num_conceptos;
                        //aumenta en uno el número de comprobantes cargados
                        AsignaNumeroConcepto();

                        asignaEventosInput();

                    } else if (datos[0].status == "404") {
                        Swal.fire({
                            icon: 'warning',
                            title: 'Mensaje',
                            text: 'No se encontró una factura asociada. Verifique los datos y/o ingrese la factura de forma manual.',
                            confirmButtonText: 'Aceptar',
                        })
                        $("#error-msj-div").hide();
                        //borra el archivo una vez que se ha cargado
                        $("#archivo_nacional_xml").val('');
                        $('#archivo_nacional_xml').next('label').html('Seleccione un archivo...');
                        $("#archivo_nacional_pdf").val('');
                        $('#archivo_nacional_pdf').next('label').html('Seleccione un archivo...');
                    }

                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Ocurrió un error obteniendo la información: ' + error,
                        confirmButtonText: 'Aceptar',
                    })
                    $("#archivo_nacional_xml").val('');
                    $('#archivo_nacional_xml').next('label').html('Seleccione un archivo...');
                    $("#archivo_nacional_pdf").val('');
                    $('#archivo_nacional_pdf').next('label').html('Seleccione un archivo...');
                }

            },
            error: function (textStatus, errorThrown) {
                //en caso de error en la llamada ajax
                Swal.fire({
                    icon: 'error',
                    title: 'Ocurrió un error: ' + errorThrown,
                    text: 'Intente nuevamente.'
                })
            },
            async: true

        });
    }
}

//completa el selec con los datos recibidos
function populateDropdown(select, data) {
    select.html('');
    $.each(data, function (id, option) {
        select.append($('<option></option>').val(option.value).html(option.name));
    });
}


//Agrega Concepto leido a la tabla
function AgregaConcepto(texto) {
    $("#body_conceptos").append(texto);
}

//variable para formatear numeros
internationalNumberFormat = new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD'
});


//verifica si existe el uuid
function ExisteUUID(uuid) {
    let existe = false;

    //elimina los '-' del uuid para hacer la comparacion
    uuid = uuid.replace('-', '').replace('-', '').replace('-', '').replace('-', '');

    $('.class-uuid').each(function (index) {
        var u = $(this).html();
        //elimina los '-' del uuid para hacer la comparacion
        u = u.replace('-', '').replace('-', '').replace('-', '').replace('-', '');

        if (uuid.toUpperCase() == u.toUpperCase())
            existe = true;
    });

    return existe;
}

//numera los concepto
function AsignaNumeroConcepto() {
    let indice = 1;

    $('.input-contador-conceptos').each(function (index) {
        $(this).html(indice);
        indice++;
    });
    CalculaTotales();
}

//borra un concepto
function borrarConcepto(uuid) {


    $('.div_' + uuid).each(function (index) {
        $(this).fadeOut(0, function () {
            $(this).remove();
        });
    });

    AsignaNumeroConcepto()
}

//Calcula los dias del viaje
function calculaDias() {
    var inicial = $('#@Html.IdFor(model => model.fecha_salida)').val();
    var regreso = $('#@Html.IdFor(model => model.fecha_regreso)').val();

    var a = moment(inicial);
    var b = moment(regreso)

    if (moment(inicial).isValid() && moment(regreso).isValid()) {
        //calcula la diferencia y actualiza los días
        var dias = b.diff(a, 'days');
        dias = dias + 1;

        $('#num_dias').val(dias);

        if (dias < 1) {
            $('#num_dias').val("--");
        }
    } else {
        $('#num_dias').val("--");
    }

}

//convierte texto a float
function TryParseFloat(str, defaultValue) {

    var retValue = defaultValue;
    if (str !== undefined && str !== null) {
        if (str.length > 0) {
            if (!isNaN(str)) {
                retValue = parseFloat(str);
            }
        }
    }
    return retValue;
}

window.onload = function () {
    clicMenu(1);
}
    </script>


}